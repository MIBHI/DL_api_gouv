<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>Application Api</title>
        <meta name="description" content="CSS only mobile first navigation">

        <!-- Toutes les icônes -->
        <link rel="apple-touch-icon" href="img/custom_icon.png">
        <link rel="apple-touch-icon" href="img/touch-icon-iphone.png">
        <link rel="apple-touch-icon" sizes="76x76" href="img/touch-icon-ipad.png">
        <link rel="apple-touch-icon" sizes="120x120" href="img/touch-icon-iphone-retina.png">
        <link rel="apple-touch-icon" sizes="152x152" href="img/touch-icon-ipad-retina.png">
        <link rel="apple-touch-startup-image" href="img/startup.png">
     
        <!-- Le meta magique pour les appareils mobiles -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
     
        <!--css-->
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/style.css">

        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->    

        <!-- Favicons-->
        <link rel="shortcut icon" href="favicon.ico">     
    </head>

    <body id="home"> 
        <div class="wrapper">     
            <header> 
                <h1 class="logo"><a href="">Nav</a></h1>             
                <a class="to_nav" href="#primary_nav" onclick="toggleMenu()" >Menu</a>             
            </header>

            <nav id="primary_nav"> 
                <ul>             
                    <li><a href="">Portfolio</a></li>             
                    <li><a href="">About Me</a></li>             
                    <li><a href="">Nonsense</a></li>             
                    <li><a href="#" onclick="getApi();return false;">Services</a></li>             
                    <li><a href="">Contact</a></li>             
                    <li class="top"><a href="#home">Top</a></li>             
                </ul>             
            </nav><!--end primary_nav-->
     
            <div style="margin: 100px 0">

                <label for="cp">Code Postal</label>
                <input type="text" id="cp" value="83300">

                <label for="type">Type</label>
                <select name="type" id="type">
                    <!--<option></option>-->
                    <option value="gazole">Gazole</option>
                    <option value="e10">E10</option>
                    <option value="e85">E85</option>
                    <option value="sp95">SP95</option>
                    <option value="sp98">SP98</option>
                    <option value="gpl">GPL</option>
                </select>

                <button id="sendRequest" onclick="makeCorsRequest()">Envoyer</button>

                <div id="reponse"></div>
            </div>
     
            <footer>     
                <p>Copyright © 2016 Mouy Manuel</p>     
            </footer>
     
        </div><!--end wrapper-->
     

        <script>

            function toggleMenu() {
                var found = false;
                var menu = document.getElementById("primary_nav");

                for (var i = 0; i <= menu.classList.length-1; i++) {

                    if (menu.classList[i]=="active"){
                        
                        found=true;
                        break;
                    } 
                }

                if (found) {

                    menu.classList.remove("active");
                } else {

                    menu.classList.add("active");
                }
            }

            function getUrl(){
                return 'http://localhost/DL_api_gouv/api/?cp='+document.getElementById("cp").value+'&type='+document.getElementById("type").value;
            }

            // Create the XHR object.
            function createCORSRequest(method, url) {
                var xhr = new XMLHttpRequest();
                if ("withCredentials" in xhr) {
                    // XHR for Chrome/Firefox/Opera/Safari.
                    xhr.open(method, url, true);
                } else if (typeof XDomainRequest != "undefined") {
                    // XDomainRequest for IE.
                    xhr = new XDomainRequest();
                    xhr.open(method, url);
                } else {
                    // CORS not supported.
                    xhr = null;
                }
                return xhr;
            }

            // Helper method to parse the title tag from the response.
            function getTitle(text) {
                return text.match('<title>(.*)?</title>')[1];
            }

            // Make the actual CORS request.
            function makeCorsRequest() {
                // This is a sample server that supports CORS.
                var url = getUrl();
                var xhr = createCORSRequest('GET', url);

                if (!xhr) {
                    alert('CORS not supported');
                    return;
                }

                // Response handlers.
                xhr.onload = function() {
                    var text = xhr.responseText;
                    //var title = getTitle(text);

                    //Array objet of data
                    var data = JSON.parse(text);

                    document.getElementById('reponse').innerHTML = data.status+'<br>';

                    for (var i = 0; i < data.results.length; i++) {
                        document.getElementById('reponse').innerHTML += 'Adresse : '+data.results[i].addr+'<br>';
                        document.getElementById('reponse').innerHTML += 'Prix : '+data.results[i].price+'<br>';
                    }



                };

                xhr.onerror = function() {
                    alert('Woops, there was an error making the request.');
                };

                xhr.send();
            }

        </script>

    </body>
</html>